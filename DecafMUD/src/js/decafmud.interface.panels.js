/*! For license information please see decafmud.interface.panels.js.LICENSE.txt */
(function(DecafMUD){var addEvent=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):(e="on"+e,t.attachEvent?t.attachEvent(e,i):t[e]=i)},delEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)},bodyHack=/Firefox\//.test(navigator.userAgent),SimpleInterface=function(t){var e=this;if(this.decaf=t,this.container=t.options.set_interface.container,"string"==typeof this.container&&(this.container=document.querySelector(this.container)),!("nodeType"in this.container))throw"The container must be a node in the DOM!";this.container.setAttribute("role","application"),this.container.className+=" decafmud mud interface",this.el_display=document.createElement("div"),this.el_display.className="decafmud mud-pane primary-pane",this.el_display.setAttribute("role","log"),this.el_display.setAttribute("tabIndex","0"),this.container.appendChild(this.el_display),this.sidebar=document.createElement("div"),this.sidebar.className="decafmud mud-pane side-pane",this.sidebar.setAttribute("tabIndex","1"),this.container.appendChild(this.sidebar),this.progresstable=document.createElement("table"),this.progresstable.style.display="none",this.sidebar.appendChild(this.progresstable),this.progressbars=new Array,this.mapdiv=document.createElement("div"),this.mapdiv.style.display="none",this.sidebar.appendChild(this.mapdiv),this.el_display.onmouseup=this.maybeFocusInput.bind(this),addEvent(this.el_display,"keydown",function(t){e.displayKey(t)}),addEvent(this.sidebar,"keydown",function(t){e.displayKey(t)}),this._input=document.createElement("div"),this._input.className="decafmud input-cont",this.tray=document.createElement("div"),this.tray.className="decafmud icon-tray",this._input.appendChild(this.tray),this.toolbuttons={},this.infobars=[],this.icons=[],this.toolbar=document.createElement("div"),this.toolbar.className="decafmud toolbar",this.toolbar.setAttribute("role","toolbar");var s=function(){this.className&&(this.className=this.className.replace(" visible",""))};addEvent(this.toolbar,"mousemove",s),addEvent(this.toolbar,"blur",s),this.input=document.createElement("input"),this.input.id="inputelement",this.input.title="MUD Input".tr(this.decaf),this.input.type="text",this.input.className="decafmud input",this._input.insertBefore(this.input,this._input.firstChild),this.container.appendChild(this._input),addEvent(this.input,"keydown",function(t){e.handleInput(t)});var o=function(t){e.handleBlur(t)};for(addEvent(this.input,"blur",o),addEvent(this.input,"focus",o),this.history=[],this.historyPosition=-1,i=0;i<100;i++)this.history[i]="";return this.reset(),addEvent(window,"resize",this.resizeScreenFromEvent.bind(this,"window resize")),"onhelp"in window&&(window.onhelp=function(){return!1}),window.onbeforeunload=this.unloadPageFromEvent.bind(this),this.input.focus(),this};SimpleInterface.prototype.toString=function(){return"<DecafMUD Interface: Simple"+(this.container.id?" (#"+this.container.id+")":"")+">"},SimpleInterface.prototype.toolbutton_id=-1,SimpleInterface.prototype.echo=!0,SimpleInterface.prototype.inpFocus=!1,SimpleInterface.prototype.old_parent=void 0,SimpleInterface.prototype.next_sib=void 0,SimpleInterface.prototype.input=void 0,SimpleInterface.prototype.display=void 0,SimpleInterface.prototype.splash=null,SimpleInterface.prototype.splash_st=null,SimpleInterface.prototype.splash_pgi=null,SimpleInterface.prototype.splash_pgt=null,SimpleInterface.prototype.splash_old=null,SimpleInterface.prototype.scrollButton=void 0,SimpleInterface.supports={tabComplete:!0,multipleOut:!1,fullscreen:!0,editor:!1,splash:!0},SimpleInterface.prototype.initSplash=function(t,e){void 0===t&&(t=0),void 0===e&&(e="Discombobulating interface recipient...".tr(this.decaf)),this.old_y=this.el_display.style.overflowY,this.el_display.style.overflowY="hidden",this.splash=document.createElement("div"),this.splash.className="decafmud splash",this.splash.innerHTML='<h2 class="decafmud heading"><a href="http://decafmud.stendec.me/">DecafMUD</a> <span class="version">v'+DecafMUD.version+"</span></h2>",this.splash_pg=document.createElement("div"),this.splash_pg.className="decafmud progress",this.splash_pg.setAttribute("role","progressbar"),this.splash_pg.setAttribute("aria-valuemax",100),this.splash_pg.setAttribute("aria-valuemin",0),this.splash_pg.setAttribute("aria-valuenow",t),this.splash_pg.setAttribute("aria-valuetext","{0}%".tr(this.decaf,t)),this.splash_pgi=document.createElement("div"),this.splash_pgi.className="decafmud inner-progress",this.splash_pgi.style.cssText="width:"+t+"%;",this.splash_pg.appendChild(this.splash_pgi),this.splash_pgt=document.createElement("div"),this.splash_pgt.className="decafmud progress-text",this.splash_pgt.innerHTML="{0}%".tr(this.decaf,t),this.splash_pg.appendChild(this.splash_pgt),this.splash.appendChild(this.splash_pg),this.splash_st=document.createElement("div"),this.splash_st.className="decafmud status",this.splash_st.innerHTML=e,this.splash.appendChild(this.splash_st),this.splash_old=document.createElement("div"),this.splash_old.className="decafmud old",this.splash_old.innerHTML="",this.splash.appendChild(this.splash_old),this.container.appendChild(this.splash)},SimpleInterface.prototype.endSplash=function(){this.container.removeChild(this.splash),this.el_display.style.overflowY=this.old_y,this.splash_err=!1,this.splash=this.splash_pg=this.splash_pgi=this.splash_pgt=this.splash_st=null},SimpleInterface.prototype.updateSplash=function(t,e){if(null!==this.splash&&!this.splash_err){if(void 0!==t){var i="{0}%".tr(this.decaf,t);this.splash_pg.setAttribute("aria-valuenow",t),this.splash_pg.setAttribute("aria-valuetext",i),this.splash_pgt.innerHTML=i,this.splash_pgi.style.cssText="width:"+t+"%;"}if(e){var s=document.createElement("div");(i=this.splash_st.innerHTML).endsWith("...")&&(i+="done."),s.innerHTML=i,this.splash_old.insertBefore(s,this.splash_old.firstChild),this.splash_st.innerHTML=e}}},SimpleInterface.prototype.splashError=function(t){return null!==this.splash&&(this.splash_pgt.innerHTML="<b>Error</b>",this.splash_pgi.className+=" error",this.splash_st.innerHTML=t,this.splash_err=!0,!0)},SimpleInterface.prototype.sizeel=void 0,SimpleInterface.prototype.sizetm=void 0,SimpleInterface.prototype.showSize=function(){if(clearTimeout(this.sizetm),void 0!==this.display){void 0===this.sizeel&&(this.sizeel=document.createElement("div"),this.sizeel.className="decafmud note center",this.container.appendChild(this.sizeel));var t=this.display.getSize();this.sizeel.style.cssText="opacity:1",this.sizeel.innerHTML="{0}x{1}".tr(this.decaf,t[0],t[1]);var e=this;this.sizetm=setTimeout(function(){e.hideSize()},500)}},SimpleInterface.prototype.hideSize=function(t){if(clearTimeout(this.sizetm),!0===t){if(void 0!==this.decaf.telopt[DecafMUD.TN.NAWS])try{this.decaf.telopt[DecafMUD.TN.NAWS].send()}catch(t){}return this.container.removeChild(this.sizeel),void(this.sizeel=void 0)}this.sizeel.style.cssText="-webkit-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="-moz-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="-o-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="transition: opacity 0.25s linear;";var e=this;setTimeout(function(){e.sizeel.style.opacity=0},0),this.sizetm=setTimeout(function(){e.hideSize(!0)},250)},SimpleInterface.prototype.print_msg=function(t){this.display.message('<span class="c6">'+t+"</span>")},SimpleInterface.prototype.connected=function(){this.updateIcon(this.ico_connected,"DecafMUD is currently connected.".tr(this.decaf),"","connectivity connected")},SimpleInterface.prototype.connecting=function(){this.print_msg(this.decaf.options.set_interface.msg_connecting),this.decaf.options.set_interface.connect_hint&&("websocket"==this.decaf.options.socket?this.display.message("<span>You are connecting using <i>websockets</i> on port "+this.decaf.options.set_socket.wsport+'.  If this does not work (for example because the port is blocked or you have an older version of websockets), you can connecting with flash.  To do so, open <a href="web_client.html?socket=flash">the flash version</a> instead.</span>'):this.display.message("<span>You are connecting using <i>flash</i> on port "+this.decaf.options.port+'.  To connect using websockets, make sure you have an up-to-date browser which supports this, and open <a href="web_client.html?socket=websocket">the websocket version</a> instead.</span>')),this.updateIcon(this.ico_connected,"DecafMUD is attempting to connect.".tr(this.decaf),"","connectivity connecting")},SimpleInterface.prototype.disconnected=function(){this.print_msg("Connection closed."),this.updateIcon(this.ico_connected,"DecafMUD is currently not connected.".tr(this.decaf),"","connectivity disconnected")},SimpleInterface.prototype.unloadPageFromEvent=function(t){return this.decaf.connected?"You are still connected.":void 0},SimpleInterface.prototype.load=function(){this.decaf.require("decafmud.display."+this.decaf.options.display)},SimpleInterface.prototype.reset=function(){this.masked=!1,this.inputCtrl=!1,this.hasFocus=!1,this.reqTab=!1,this.wantTab=!1,this.tabIndex=-1,this.tabValues=[],this.buffer="",void 0!==this.input&&this.updateInput(),void 0!==this.display&&this.display.reset()},SimpleInterface.prototype.setup=function(){this.store=this.decaf.store.sub("ui"),this.storage=this.store;var t=this.store.get("toolbar-position","top-left");this.old_tbarpos=t,this.toolbar.className+=" "+t,this.container.insertBefore(this.toolbar,this.container.firstChild);var e=this.decaf.options.display;this.decaf.debugString('Initializing display plugin "'+e+'" in: #'+this.el_display.id,"info"),this.display=new DecafMUD.plugins.Display[e](this.decaf,this,this.el_display),this.display.id="mud-display",this.decaf.display=this.display;var s=get_menus();for(i=0;i<s.length;i+=3)this.tbNew(s[i],s[i+1].tr(this.decaf),void 0,s[i+2].tr(this.decaf),1,!0,!1,void 0,function(t){return function(e){toggle_menu(t/3)}}(i));this.goFullOnResize=!1;var o=this.store.get("fullscreen-start",this.decaf.options.set_interface.start_full);this.ico_connected=this.addIcon("You are currently disconnected.".tr(this.decaf),"","connectivity disconnected"),o?this.enter_fs(!1):this._resizeToolbar()||this.resizeScreen(!1)},SimpleInterface.prototype.tbDelete=function(t){if(void 0!==this.toolbuttons[t]){var e=this.toolbuttons[t];e[0].parentNode.removeChild(e[0]),this.toolbuttons[t]=void 0,delete e,this._resizeToolbar()}},SimpleInterface.prototype.tbText=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";if(!e)throw"Text can't be empty/false/null/whatever.";i[0].innerHTML=e,void 0===i[3]&&(i[3]=e,i[0].title=e)},SimpleInterface.prototype.tbTooltip=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";i[3]=e,i[0].title=e||i[1]},SimpleInterface.prototype.tbEnabled=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";e=!!e,i[5]=e,i[0].setAttribute("aria-disabled",!e),e?i[0].className=i[0].className.replace(" disabled",""):/disabled/.test(i[0].className)||(i[0].className+=" disabled")},SimpleInterface.prototype.tbPressed=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";e=!!e,i[6]=e,i[0].setAttribute("aria-pressed",e),e?/toggle-depressed/.test(i[0].className)&&(i[0].className=i[0].className.replace(" toggle-depressed"," toggle-pressed")):/toggle-pressed/.test(i[0].className)&&(i[0].className=i[0].className.replace(" toggle-pressed"," toggle-depressed"))},SimpleInterface.prototype.tbClass=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";var s=i[7];i[7]=e,void 0!==s&&(i[0].className=i[0].className.replace(" "+s,"")),e&&(i[0].className+=" "+e)},SimpleInterface.prototype.tbIcon=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";i[2]=e,e?(/ icon/.test(i[0].className)||(i[0].className+=" icon"),i[0].style.cssText="background-image: url("+e+");"):(i[0].className=i[0].className.replace(" icon",""),i[0].style.cssText="")},SimpleInterface.prototype.tbNew=function(t,e,i,s,o,n,a,r,l){if("function"==typeof i){var p=l;l=i,i=s,s=o,o=n,n=a,a=r,r=p}var h=++this.toolbutton_id,c=document.createElement("span");if(c.id=t,c.className="decafmud button toolbar-button",r&&(c.className+=" "+r),1===o&&(c.className+=" toggle "+(a?"toggle-pressed":"toggle-depressed")),c.innerHTML=e,c.title=s||e,!1!==n&&(n=!0),n||(c.className+=" disabled"),c.setAttribute("tabIndex","0"),c.setAttribute("role","button"),c.setAttribute("aria-disabled",!n),1===o&&c.setAttribute("aria-pressed",a),i&&(c.style.cssText="background-image: url("+i+");",c.className+=" icon"),l){var d=this,u=function(t){if("keydown"!==t.type||13===t.keyCode){var e=d.toolbuttons[h];!0===e[5]&&(l.call(d,t),t.type&&"keydown"!==t.type&&e[0].blur())}};addEvent(c,"click",u),addEvent(c,"keydown",u)}return addEvent(c,"focus",function(t){this.parentNode&&/toolbar/.test(this.parentNode.className)&&(this.parentNode.setAttribute("aria-activedescendant",this.id),this.parentNode.className+=" visible")}),addEvent(c,"blur",function(t){this.parentNode&&/toolbar/.test(this.parentNode.className)&&(this.parentNode.getAttribute("aria-activedescendant")===this.id&&this.parentNode.setAttribute("aria-activedescendant",""),this.parentNode.className=this.parentNode.className.replace(" visible",""))}),this.toolbuttons[h]=[c,e,i,s,o,n,a,r,l],c.setAttribute("button-id",h),this.toolbar.appendChild(c),this._resizeToolbar(),h},SimpleInterface.prototype.toolbarPadding=void 0,SimpleInterface.prototype._resizeToolbar=function(){this.toolbar.style.cssText;var t=!1;return this.display&&this.toolbarPadding!==this.toolbar.clientHeight?(this.display.shouldScroll(),this.el_display.style.paddingTop=this.toolbar.clientHeight+"px",this.toolbarPadding=this.toolbar.clientHeight,this.resizeScreen(!1,!0),this.display.doScroll(),t=!0):this.toolbarPadding=this.toolbar.clientHeight,t},SimpleInterface.prototype.showScrollButton=function(){if(void 0===this.scrollButton){var t=document.createElement("div"),e=this;t.className="button scroll-button",t.setAttribute("tabIndex",0),t.innerHTML="More".tr(this.decaf);var i=function(t){"keydown"==t.type&&13!==t.keyCode||e.display.scrollNew()};addEvent(t,"click",i),addEvent(t,"keydown",i),this.scrollButton=t,this.container.appendChild(t),t.style.cssText="bottom:"+(this._input.offsetHeight+12)+"px"}},SimpleInterface.prototype.hideScrollButton=function(){void 0!==this.scrollButton&&(this.scrollButton.parentNode.removeChild(this.scrollButton),this.scrollButton=void 0)},SimpleInterface.prototype.infoBar=function(t,e,i,s,o,n,a){if("number"==typeof e){var r=i;i=e,e=r}void 0===e&&(e="info"),void 0===i&&(i=0);var l={text:t,class:e,timeout:i,icon:s,buttons:o,click:n,close:a};this.infobars.push(l),void 0===this.ibar&&this.createIBar()},SimpleInterface.prototype.immediateInfoBar=function(t,e,i,s,o,n,a){return void 0===this.ibar&&(this.infoBar(t,e,i,s,o,n,a),!0)};var addButton=function(t,e,i){var s=document.createElement("a");s.className="button",s.setAttribute("href","#"),s.setAttribute("onclick","return false;"),s.innerHTML=e[0],addEvent(s,"click",function(t){return i.closeIBar(!0),setTimeout(function(){e[1].call(i,t)},0),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1}),t.appendChild(s)};SimpleInterface.prototype.createIBar=function(){var t=this,e=this.infobars[0],i=document.createElement("div");i.setAttribute("role","alert"),i.className="decafmud infobar "+e.class,i.innerHTML=e.text,i.style.cssText="top: -26px;",void 0!==e.click&&(i.className+=" clickable",i.setAttribute("tabIndex","0"));var s=function(i){void 0===i||"keydown"===i.type&&13!==i.keyCode&&27!==i.keyCode||("click"!==i.type||e.click)&&(i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation(),t.closeIBar(!0),"keydown"!==i.type||27!==i.keyCode?e.click&&e.click.call(t,i):e.close&&e.close.call(t,i))};addEvent(i,"click",s),addEvent(i,"keydown",s);var o=document.createElement("div");o.innerHTML="X",o.className="close",o.setAttribute("tabIndex","0");var n=function(i){void 0===i||"keydown"===i.type&&13!==i.keyCode||(t.closeIBar(!0),e.close&&e.close.call(t,i),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation())};if(addEvent(o,"click",n),addEvent(o,"keydown",n),i.insertBefore(o,i.firstChild),e.buttons){var a=document.createElement("div");a.className="btncont";for(var r=0;r<e.buttons.length;r++)addButton(a,e.buttons[r],this);i.insertBefore(a,o)}this.ibar=i,e.el=i,this.container.insertBefore(i,this.container.firstChild),setTimeout(function(){var s=0;window.getComputedStyle?s=parseInt(getComputedStyle(i,null).paddingTop):i.currentStyle&&(s=parseInt(i.currentStyle.paddingTop)),t.toolbarPadding&&(s+=t.toolbarPadding-10),i.style.cssText="background-position: 5px "+s+"px;padding-top: "+s+"px;-webkit-transition: top 0.1s linear;-moz-transition: top 0.1s linear;-o-transition: top 0.1s linear;transition: top 0.1s linear; top: inherit",e.icon&&(i.style.cssText+='background-image: url("'+e.icon+'")')},0),e.timeout>0&&(this.ibartimer=setTimeout(function(){t.closeIBar()},1e3*e.timeout))},SimpleInterface.prototype.closeIBar=function(t){if(void 0!==this.ibar)if(clearTimeout(this.ibartimer),t)this.ibar.parentNode.removeChild(this.ibar),delete this.ibar,this.infobars.shift(),this.infobars.length>0&&this.createIBar();else{this.ibar.style.cssText+="-webkit-transition: opacity 0.25s linear;-moz-transition: opacity 0.25s linear;-o-transition: opacity 0.25s linear;transition: opacity 0.25s linear; opacity: 0";var e=this;this.ibartimer=setTimeout(function(){e.closeIBar(!0)},250)}},SimpleInterface.prototype.addIcon=function(t,e,i,s,o){var n=document.createElement("div");n.className="decafmud status-icon "+i+(s?" icon-click":""),n.innerHTML=e,n.setAttribute("title",t),n.setAttribute("role","status"),n.setAttribute("aria-label",t),(s||o)&&n.setAttribute("tabIndex","0");for(var a=this.icons.push([n,s,o])-1,r=0;r<this.icons.length;r++)this.icons[r][0].style.cssText="right:"+21*(this.icons.length-r-1)+"px";this.tray.appendChild(n);var l=this;return s&&addEvent(n,"click",function(t){s.call(l,t)}),s&&!o&&addEvent(n,"keydown",function(t){13===t.keyCode&&s.call(l,t)}),o&&addEvent(n,"keydown",function(t){o.call(l,t)}),this._resizeTray(),a},SimpleInterface.prototype.delIcon=function(t){if(t<0||t>=this.icons.length)throw"Invalid index for icon!";var e=this.icons[t][0];this.icons.splice(t,1),this._input.removeChild(e),delete e;for(var i=0;i<this.icons.length;i++)this.icons[i].style.cssText="right:"+21*(this.icons.length-i-1)+"px";this._resizeTray()},SimpleInterface.prototype.updateIcon=function(t,e,i,s){if(t<0||t>=this.icons.length)throw"Invalid index for icon!";var o=this.icons[t],n=o[1];o[2],o=o[0],s&&(o.className="decafmud status-icon "+s+(n?" icon-click":"")),i&&(o.innerHTML=i),e&&(o.setAttribute("title",e),o.setAttribute("aria-label",e))},SimpleInterface.prototype._resizeTray=function(){var t=this.tray.clientWidth;this._input.style.cssText="padding-right:"+t+"px"},SimpleInterface.prototype.click_fsbutton=function(t){-1===this.container.className.indexOf("fullscreen")?this.enter_fs():this.exit_fs()},SimpleInterface.prototype.oldscrollX=void 0,SimpleInterface.prototype.oldscrollY=void 0,SimpleInterface.prototype.old_children=[],SimpleInterface.prototype.old_display=[],SimpleInterface.prototype.enter_fs=function(t){if(-1===this.container.className.indexOf("fullscreen")){var e=this.inpFocus;this.display&&this.display.shouldScroll(!1),this.oldscrollY=window.scrollY,this.oldscrollX=window.scrollX,this.old_parent=this.container.parentNode,this.next_sib=this.container.nextElementSibling,void 0===this.next_sib&&this.container.nextSibling&&this.container.nextSibling.nodeType==this.container.nodeType&&(this.next_sib=this.container.nextSibling),this.old_parent.removeChild(this.container),this.container.className+=" fullscreen";for(var i=0;i<document.body.children.length;i++){var s=document.body.children[i];"_firebugConsole"!==s.id&&0!==s.id.indexOf("DecafFlashSocket")&&(this.old_children.push(s),this.old_display.push(s.style.display),s.style.display="none")}this.old_body_over=document.body.style.overflow,bodyHack||(document.body.style.overflow="hidden"),document.body.appendChild(this.container),window.scroll(0,0),this._resizeToolbar(),this.resizeScreen(t,!1),!1!==t&&this.showSize(),e&&this.input.focus(),this.display&&this.display.doScroll()}},SimpleInterface.prototype.exit_fs=function(){if(void 0!==this.old_parent){var t=this.inpFocus;this.display&&this.display.shouldScroll(!1),this.container.parentNode.removeChild(this.container);for(var e=0;e<this.old_children.length;e++)this.old_children[e].style.display=this.old_display[e];this.old_children=[],this.old_display=[];var i=this.container.className.split(" ");for(e=0;e<i.length;)"fullscreen"!==i[e]?e++:i.splice(e,1);this.container.className=i.join(" "),void 0!==this.next_sib&&null!==this.next_sib?this.old_parent.insertBefore(this.container,this.next_sib):this.old_parent.appendChild(this.container),document.body.style.overflow=this.old_body_over,window.scroll(this.oldscrollX,this.oldscrollY),this._resizeToolbar(),this.showSize(),t&&this.input.focus(),this.display&&this.display.doScroll()}},SimpleInterface.prototype.old_height=-1,SimpleInterface.prototype.old_width=-1,SimpleInterface.prototype.old_fs=!1,SimpleInterface.prototype.resizeScreen=function(t,e){if(this.goFullOnResize){var i=!0===window.fullScreen;if(i||(window.outerHeight?i=window.screen.height-window.outerHeight<=5:window.innerHeight&&(i=window.screen.height-window.innerHeight<=5)),i&&!this.old_fs)return this.old_fs=i,void this.enter_fs();if(!i&&this.old_fs)return this.old_fs=i,void this.exit_fs();this.old_fs=i}if(!0===e||this.old_height!==this.container.offsetHeight||this.old_width!==this.container.offsetWidth){this.hidePopup(),this.old_height=this.container.offsetHeight,this.old_width=this.container.offsetWidth;var s=this.old_height-(this._input.offsetHeight+17);this.toolbarPadding&&(s-=this.toolbarPadding-12),s<0&&(s=0),this.popup&&(this.set_mid.style.height=s+"px"),this.toolbarPadding&&(s-=12)<0&&(s=0),this.el_display.style.height=s+"px",!0!==e&&this.display&&this.display.scroll(),this.scrollButton&&(this.scrollButton.style.cssText="bottom:"+(this._input.offsetHeight+12)+"px"),!1!==t&&this.showSize()}},SimpleInterface.prototype.resizeScreenFromEvent=function(t,e){this.resizeScreen(!0,!1)},SimpleInterface.prototype.showSidebar=function(){this.sidebar.style.display="inline"},SimpleInterface.prototype.hideSidebar=function(){this.sidebar.style.display="none"},SimpleInterface.prototype.showProgressBars=function(){this.progresstable.style.display="inline",this.progresstable.style.height="auto"},SimpleInterface.prototype.hideProgressBars=function(){this.progresstable.style.display="none",this.progresstable.style.height="0"},SimpleInterface.prototype.showMap=function(){this.mapdiv.style.display="inline"},SimpleInterface.prototype.hideMap=function(){this.mapdiv.style.display="none"},SimpleInterface.prototype.addProgressBar=function(t,e){var i=document.createElement("tr");this.progresstable.appendChild(i);var s=document.createElement("td");i.appendChild(s),s.innerHTML=t+":",s=document.createElement("td"),i.appendChild(s);var o=document.createElement("div");o.style.width="100px",o.style.height="20px",o.style.backgroundColor="white",o.style.padding="0px";var n=document.createElement("div");n.style.width="0px",n.style.height="20px",n.style.backgroundColor=e,n.style.color="black",n.style.padding="0px",n.style.overflow="hidden",n.style.overflowX="visible";var a=document.createElement("div");a.style.width=o.style.width,a.style.height=o.style.height,a.style.marginTop="-20px",a.style.textAlign="center",a.style.paddingTop="3px",a.style.fontWeight="bold",a.style.color="black",s.appendChild(o),o.appendChild(n),s.appendChild(a);var r=this.progressbars.length;this.progressbars[r]=[t,n,a]},SimpleInterface.prototype.setProgress=function(t,e,s){for(i=0;i<this.progressbars.length;i++)this.progressbars[i][0]==t&&(this.progressbars[i][1].style.width=100*e/100+"px",this.progressbars[i][2].innerHTML=s)},SimpleInterface.prototype.setProgressColor=function(t,e){for(i=0;i<this.progressbars.length;i++)this.progressbars[i][0]==t&&(this.progressbars[i][1].style.backgroundColor=e)},SimpleInterface.prototype.printMap=function(t){this.mapdiv.innerHTML="<hr><i>Map:</i><center>"+t+"</center>"},SimpleInterface.prototype.popup=void 0,SimpleInterface.prototype.headerdrag=void 0,SimpleInterface.prototype.popupheader=void 0,SimpleInterface.prototype.maxPopupHeight=function(){var t=this.container.offsetHeight-(this._input.offsetHeight+50);return this.toolbarPadding&&(t-=this.toolbarPadding-12),t<0&&(t=0),t},SimpleInterface.prototype.maxPopupWidth=function(){var t=this.container.offsetWidth-12;return t<0&&(t=0),t},SimpleInterface.prototype.verticalPopupOffset=function(){return 50},SimpleInterface.prototype.horizontalPopupOffset=function(){return 0},SimpleInterface.prototype.hidePopup=function(){this.popup&&(this.headerdrag.StopListening(!0),this.popup.parentNode.removeChild(this.popup),this.popup=void 0,this.popupheader=void 0,this.input.focus())},SimpleInterface.prototype.showPopup=function(){this.popup&&this.hidePopup(),this.popup=document.createElement("div");var t=this.maxPopupWidth(),e=this.maxPopupHeight(),i=this.verticalPopupOffset(),s=this.horizontalPopupOffset();s+=2*t/10,t=6*t/10,e=7*e/10,this.popup.style.width=t+"px",this.popup.style.height=e+"px",this.popup.style.top=i+"px",this.popup.style.left=s+"px",this.popup.className="decafmud window",this.popup.id="popup",this.container.insertBefore(this.popup,this.el_display),this.popupheader=document.createElement("div"),this.popupheader.style.width=t+"px",this.popupheader.style.height="25px",this.popupheader.style.top="0px",this.popupheader.className="decafmud window-header",this.popupheader.id="popupheader",this.popup.appendChild(this.popupheader),this.headerdrag=new dragObject("popup","popupheader");var o=document.createElement("button");o.innerHTML="<big>X</big>",o.className="closebutton";var n=this;return addEvent(o,"click",function(t){n.hidePopup()}),this.popup.appendChild(o),addEvent(this.popup,"mousedown",function(t){1==t.which&&-1!==open_menu&&close_menus()}),this.popup},SimpleInterface.prototype.popupHeader=function(t){var e=document.createElement("p");e.innerHTML=t,e.className="headertext",this.popup.appendChild(e)},SimpleInterface.prototype.buttonLine=function(t){var e=document.createElement("p");return e.style.textAlign="center",t.appendChild(e),e},SimpleInterface.prototype.createButton=function(caption,func){var btn=document.createElement("button");return btn.className="prettybutton",btn.innerHTML="<big>"+caption+"</big>",btn.onclick="string"==typeof func||func instanceof String?function(){eval(func)}:func,btn},SimpleInterface.prototype.popupTextarea=function(t,e){var i=6*this.maxPopupWidth()/10-15,s=7*this.maxPopupHeight()/10-100-e,o=document.createElement("textarea");return o.id=t,o.cols=80,o.rows=20,o.style.width=i+"px",o.style.height=s+"px",o.style.margin="5px",this.popup.appendChild(o),o.focus(),o},SimpleInterface.prototype.popupTextdiv=function(){var t=6*this.maxPopupWidth()/10-10,e=7*this.maxPopupHeight()/10-60,i=document.createElement("div");return i.style.width=t+"px",i.style.height=e+"px",i.style.margin="5px",i.style.overflowY="auto",this.popup.appendChild(i),i},SimpleInterface.prototype.displayInput=function(t){this.display&&this.echo&&this.display.message('<span class="command">'+t+"</span>","user-input",!1)},SimpleInterface.prototype.localEcho=function(t){t!==this.echo&&(this.echo=t,this.updateInput())},SimpleInterface.prototype.maybeFocusInput=function(t){var e=getSelection();e&&""!==e.toString()&&this.el_display.contains(e.focusNode.parentNode)?this.decaf.debugString("not focusing this.input: selection active"):this.input.focus()},SimpleInterface.prototype.displayKey=function(t){t.altKey||t.ctrlKey||t.metaKey||(t.keyCode>64&&t.keyCode<91||t.keyCode>47&&t.keyCode<58||t.keyCode>185&&t.keyCode<193||t.keyCode>218&&t.keyCode<223)&&this.input.focus()},SimpleInterface.prototype.handleInputPassword=function(t){13===t.keyCode&&(this.inpFocus=!0,this.decaf.sendInput(this.input.value),this.input.value="")},SimpleInterface.prototype.saveInputInHistory=function(){if(txt=this.input.value,""!=txt&&txt!=this.history[0]){var t=-1;for(i=0;i<this.history.length;i++)if(this.history[i]==txt){t=i;break}for(-1==t&&(t=this.history.length-1),i=t;i>0;i--)this.history[i]=this.history[i-1];this.history[0]=txt}},SimpleInterface.prototype.inputModified=function(){return txt=this.input.value,-1==this.historyposition?""!==txt:txt!==this.history[this.historyPosition]},SimpleInterface.prototype.loadInput=function(){-1==this.historyPosition?this.input.value="":(this.input.focus(),this.input.value=this.history[this.historyPosition])},SimpleInterface.prototype.parseInput=function(t){lines=t.split(";;");for(var e=0,i=lines.length;e<i;e++)this.decaf.sendInput(lines[e])},SimpleInterface.prototype.handleInput=function(t){"keydown"===t.type&&(112!=t.keyCode&&116!==t.keyCode||t.preventDefault(),13===t.keyCode?(this.parseInput(this.input.value),this.saveInputInHistory(),this.historyPosition=0,this.decaf.options.set_interface.repeat_input||(this.input.value=""),this.input.select()):void 0!==window.tryExtraMacro&&tryExtraMacro(this.decaf,t.keyCode)?t.preventDefault?t.preventDefault():t.returnValue=!1:33===t.keyCode?this.display&&this.display.scrollUp&&(this.display.scrollUp(),t.preventDefault()):34===t.keyCode?this.display&&this.display.scrollDown&&(this.display.scrollDown(),t.preventDefault()):40==t.keyCode?(this.inputModified()&&(this.historyPosition=-1),-1==this.historyPosition?this.saveInputInHistory():0==this.historyPosition?this.historyPosition=-1:this.historyPosition=this.historyPosition-1,this.loadInput()):38==t.keyCode?(this.inputModified()&&(this.historyPosition=-1),-1==this.historyPosition?""==this.input.value?this.historyPosition=0:(this.saveInputInHistory(),this.historyPosition=1):this.historyPosition<this.history.length-1&&(this.historyPosition=this.historyPosition+1),this.loadInput()):8==t.keyCode&&!0===t.shiftKey&&(this.input.value=""))},SimpleInterface.prototype.handleBlur=function(t){var e=this.input,i=this.decaf.options.set_interface.blurclass;if("blur"===t.type){""===e.value&&(e.className+=" "+i);var s=this;setTimeout(function(){s.settings&&(s.settings.style.top="0px",s.set_mid.style.overflowY="scroll")},100),this.inpFocus=!1}else if("focus"===t.type){for(var o=e.className.split(" "),n=[],a=0;a<o.length;a++)o[a]!==i&&n.push(o[a]);if(e.className=n.join(" "),this.settings){var r=.5*this.settings.clientHeight*-1;this.settings.style.top=r+"px",this.set_mid.style.overflowY="hidden"}this.inpFocus=!0}},SimpleInterface.prototype.updateInput=function(t){if(this.input){var e,i=this.inpFocus,s=this,o=this.input;if(e="TEXTAREA"===this.input.tagName?"text":o.type,!0===t||!(!this.echo&&"password"===e||this.echo&&"password"!==e)){var n,a=o.className,r=o.getAttribute("style"),l=o.id,p=o.parentNode;if(void 0===(n=o.nextElementSibling)&&o.nextSibling&&o.nextSibling.nodeType===o.nodeType&&(n=o.nextSibling),this.echo){var h=1;this.inp_buffer&&(h=this.inp_buffer.substr_count("\n")+1),1===h?(c=document.createElement("input")).type="text":(c=document.createElement("textarea"),bodyHack?c.setAttribute("rows",h-1):c.setAttribute("rows",h)),a&&(c.className=a),r&&c.setAttribute("style",r),this.inp_buffer&&(c.value=this.inp_buffer),p.removeChild(o),delete o,delete this.input,l&&(c.id=l),n?p.insertBefore(c,n):p.appendChild(c),this.input=c,addEvent(c,"keydown",function(t){s.handleInput(t)})}else{var c;this.inp_buffer=o.value,(c=document.createElement("input")).type="password",a&&(c.className=a),r&&c.setAttribute("style",r),p.removeChild(o),delete o,delete this.input,l&&(c.id=l),n?p.insertBefore(c,n):p.appendChild(c),this.input=c,addEvent(c,"keydown",function(t){s.handleInputPassword(t)})}this.inpFocus=i;var d=function(t){s.handleBlur(t)};addEvent(this.input,"blur",d),addEvent(this.input,"focus",d),this.inpFocus&&setTimeout(function(){s.input.select(),s.input.focus()},1)}}},DecafMUD.plugins.Interface.panels=SimpleInterface})(DecafMUD);