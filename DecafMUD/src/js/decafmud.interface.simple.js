/*! For license information please see decafmud.interface.simple.js.LICENSE.txt */
!function(t){var e=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):(e="on"+e,t.attachEvent?t.attachEvent(e,i):t[e]=i)},i=/Firefox\//.test(navigator.userAgent),s=function(t){var i=this;if(this.decaf=t,this.container=t.options.set_interface.container,"string"==typeof this.container&&(this.container=document.querySelector(this.container)),!("nodeType"in this.container))throw"The container must be a node in the DOM!";this.container.setAttribute("role","application"),this.container.className+=" decafmud mud interface",this.el_display=document.createElement("div"),this.el_display.className="decafmud mud-pane primary-pane",this.el_display.setAttribute("role","log"),this.el_display.setAttribute("aria-live","assertive"),this.el_display.setAttribute("tabIndex","0"),this.container.appendChild(this.el_display),e(this.el_display,"keydown",function(t){i.displayKey(t)}),this._input=document.createElement("div"),this._input.className="decafmud input-cont",this.tray=document.createElement("div"),this.tray.className="decafmud icon-tray",this._input.appendChild(this.tray),this.toolbuttons={},this.infobars=[],this.icons=[],this.toolbar=document.createElement("div"),this.toolbar.className="decafmud toolbar",this.toolbar.setAttribute("role","toolbar");var s=function(){this.className&&(this.className=this.className.replace(" visible",""))};e(this.toolbar,"mousemove",s),e(this.toolbar,"blur",s),this.input=document.createElement("input"),this.input.title="MUD Input".tr(this.decaf),this.input.setAttribute("role","textbox"),this.input.setAttribute("aria-label",this.input.title),this.input.type="text",this.input.className="decafmud input",this._input.insertBefore(this.input,this._input.firstChild),this.container.appendChild(this._input),e(this.input,"keydown",function(t){i.handleInput(t)});var o=function(t){i.handleBlur(t)};return e(this.input,"blur",o),e(this.input,"focus",o),this.reset(),e(window,"resize",function(){i.resizeScreen()}),this};s.prototype.toString=function(){return"<DecafMUD Interface: Simple"+(this.container.id?" (#"+this.container.id+")":"")+">"},s.prototype.toolbutton_id=-1,s.prototype.echo=!0,s.prototype.inpFocus=!1,s.prototype.old_parent=void 0,s.prototype.next_sib=void 0,s.prototype.input=void 0,s.prototype.display=void 0,s.prototype.splash=null,s.prototype.splash_st=null,s.prototype.splash_pgi=null,s.prototype.splash_pgt=null,s.prototype.splash_old=null,s.prototype.scrollButton=void 0,s.supports={tabComplete:!0,multipleOut:!1,fullscreen:!0,editor:!1,splash:!0},s.prototype.initSplash=function(e,i){void 0===e&&(e=0),void 0===i&&(i="Discombobulating interface recipient...".tr(this.decaf)),this.old_y=this.el_display.style.overflowY,this.el_display.style.overflowY="hidden",this.splash=document.createElement("div"),this.splash.className="decafmud splash",this.splash.innerHTML='<h2 class="decafmud heading"><a href="https://github.com/MUME/DecafMUD">DecafMUD</a> <span class="version">v'+t.version+"</span></h2>",this.splash_pg=document.createElement("div"),this.splash_pg.className="decafmud progress",this.splash_pg.setAttribute("role","progressbar"),this.splash_pg.setAttribute("aria-valuemax",100),this.splash_pg.setAttribute("aria-valuemin",0),this.splash_pg.setAttribute("aria-valuenow",e),this.splash_pg.setAttribute("aria-valuetext","{0}%".tr(this.decaf,e)),this.splash_pgi=document.createElement("div"),this.splash_pgi.className="decafmud inner-progress",this.splash_pgi.style.cssText="width:"+e+"%;",this.splash_pg.appendChild(this.splash_pgi),this.splash_pgt=document.createElement("div"),this.splash_pgt.className="decafmud progress-text",this.splash_pgt.innerHTML="{0}%".tr(this.decaf,e),this.splash_pg.appendChild(this.splash_pgt),this.splash.appendChild(this.splash_pg),this.splash_st=document.createElement("div"),this.splash_st.className="decafmud status",this.splash_st.innerHTML=i,this.splash.appendChild(this.splash_st),this.splash_old=document.createElement("div"),this.splash_old.className="decafmud old",this.splash_old.innerHTML="",this.splash.appendChild(this.splash_old),this.container.appendChild(this.splash)},s.prototype.endSplash=function(){this.container.removeChild(this.splash),this.el_display.style.overflowY=this.old_y,this.splash_err=!1,this.splash=this.splash_pg=this.splash_pgi=this.splash_pgt=this.splash_st=null},s.prototype.updateSplash=function(t,e){if(null!==this.splash&&!this.splash_err){if(void 0!==t){var i="{0}%".tr(this.decaf,t);this.splash_pg.setAttribute("aria-valuenow",t),this.splash_pg.setAttribute("aria-valuetext",i),this.splash_pgt.innerHTML=i,this.splash_pgi.style.cssText="width:"+t+"%;"}if(e){var s=document.createElement("div");(i=this.splash_st.innerHTML).endsWith("...")&&(i+="done."),s.innerHTML=i,this.splash_old.insertBefore(s,this.splash_old.firstChild),this.splash_st.innerHTML=e}}},s.prototype.splashError=function(t){return null!==this.splash&&(this.splash_pgt.innerHTML="<b>Error</b>",this.splash_pgi.className+=" error",this.splash_st.innerHTML=t,this.splash_err=!0,!0)},s.prototype.sizeel=void 0,s.prototype.sizetm=void 0,s.prototype.showSize=function(){if(clearTimeout(this.sizetm),void 0!==this.display){void 0===this.sizeel&&(this.sizeel=document.createElement("div"),this.sizeel.className="decafmud note center",this.container.appendChild(this.sizeel));var t=this.display.getSize();this.sizeel.style.cssText="opacity:1",this.sizeel.innerHTML="{0}x{1}".tr(this.decaf,t[0],t[1]);var e=this;this.sizetm=setTimeout(function(){e.hideSize()},500)}},s.prototype.hideSize=function(e){if(clearTimeout(this.sizetm),!0===e){if(void 0!==this.decaf.telopt[t.TN.NAWS])try{this.decaf.telopt[t.TN.NAWS].send()}catch(t){}return this.container.removeChild(this.sizeel),void(this.sizeel=void 0)}this.sizeel.style.cssText="-webkit-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="-moz-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="-o-transition: opacity 0.25s linear;",this.sizeel.style.cssText+="transition: opacity 0.25s linear;";var i=this;setTimeout(function(){i.sizeel.style.opacity=0},0),this.sizetm=setTimeout(function(){i.hideSize(!0)},250)},s.prototype.connected=function(){this.updateIcon(this.ico_connected,"DecafMUD is currently connected.".tr(this.decaf),"","connectivity connected")},s.prototype.connecting=function(){this.updateIcon(this.ico_connected,"DecafMUD is attempting to connect.".tr(this.decaf),"","connectivity connecting")},s.prototype.disconnected=function(){this.updateIcon(this.ico_connected,"DecafMUD is currently disconnected.".tr(this.decaf),"","connectivity disconnected")},s.prototype.load=function(){this.decaf.require("decafmud.display."+this.decaf.options.display)},s.prototype.reset=function(){this.masked=!1,this.inputCtrl=!1,this.mruIndex=0,this.mruHistory=[],this.mruSize=this.decaf.options.set_interface.mru_size,this.mruTemp=!1,this.hasFocus=!1,this.reqTab=!1,this.wantTab=!1,this.tabIndex=-1,this.tabValues=[],this.buffer="",void 0!==this.input&&this.updateInput(),void 0!==this.display&&this.display.reset()},s.prototype.setup=function(){this.store=this.decaf.store.sub("ui"),this.storage=this.store;var e=this.store.get("toolbar-position","top-left");this.old_tbarpos=e,this.toolbar.className+=" "+e,this.container.insertBefore(this.toolbar,this.container.firstChild);var i=this.decaf.options.display;this.decaf.debugString('Initializing display plugin "'+i+'" in: #'+this.el_display.id,"info"),this.display=new t.plugins.Display[i](this.decaf,this,this.el_display),this.decaf.display=this.display,this.goFullOnResize=this.store.get("fullscreen-auto",!0);var s=this.store.get("fullscreen-start",this.decaf.options.set_interface.start_full);this.fsbutton=this.tbNew("Fullscreen".tr(this.decaf),void 0,"Click to enter fullscreen mode.".tr(this.decaf),1,!0,s,void 0,function(t){this.click_fsbutton(t)}),this.logbutton=this.tbNew("Logs".tr(this.decaf),void 0,"Click to open a window containing this session's logs.".tr(this.decaf),0,!0,!1,void 0,function(t){this.showLogs()}),this.ico_connected=this.addIcon("You are currently disconnected.".tr(this.decaf),"","connectivity disconnected"),s?this.enter_fs(!1):this._resizeToolbar()||this.resizeScreen(!1)},s.prototype.showLogs=function(){var t="",e="";if(window.getComputedStyle){for(var i=this.display.display,s=0;i;){if((s+=1)>15)return void alert("Too high count!");if((o=getComputedStyle(i,null)).backgroundColor&&"transparent"!==o.backgroundColor&&"rgba("!==o.backgroundColor.substr(0,5)){t="background-color:"+o.backgroundColor+";";break}if(i===document.body)break;i=i.parentNode}var o;t||(t="background-color:#000;"),t="body{"+t+"color:"+(o=getComputedStyle(this.display.display,null)).color+";}",e="div{font-family:"+o.fontFamily+";font-size:"+o.fontSize+";}"}else t="body{background:#000;color:#C0C0C0;}",e="div{font-family:monospace;}";var n="data:text/html,";n+="<html><head><title>",n+="DecafMUD Session Log".tr(this.decaf),n+="</title><style>"+t+e+"</style></head><body>",n+="<h1>",n+="DecafMUD Session Log".tr(this.decaf),n+="</h2>",n+="<div>"+this.display.display.innerHTML+"</div>",n+="</body></html>",window.open(n,"log-window","width=700,height=400,directories=no,location=no,menubar=no,status=no,toolbar=no,scrollbars=yes")},s.prototype.settings=void 0,s.prototype.showSettings=function(){if(this.settings)return this.settings.parentNode.removeChild(this.settings),this.settings=void 0,this.set_cont=void 0,this.tbPressed(this.stbutton,!1),this.tbTooltip(this.stbutton,"Click to change DecafMUD's settings.".tr(this.decaf)),void this.el_display.setAttribute("tabIndex","0");var t=document.createElement("div");t.className="decafmud window settings",this.toolbarPadding&&(t.style.paddingTop=this.toolbarPadding-5+"px");var e=document.createElement("div");e.className="decafmud window-middle",t.appendChild(e);var i=document.createElement("div");i.className="decafmud window-inner",e.appendChild(i);var s=document.createElement("h2");s.innerHTML="DecafMUD Settings".tr(this.decaf),i.appendChild(s);var o=document.createElement("p");for(var n in o.innerHTML="Use the form below to adjust DecafMUD's settings, then click Apply when you're done.".tr(this.decaf),i.appendChild(o),this.decaf.settings){var a=this.decaf.settings[n],l=document.createElement("fieldset");l.className="decafmud settings";var r=n.substr(0,1).toUpperCase()+n.substr(1);void 0!==a._name&&(r=a._name),(p=document.createElement("legend")).innerHTML=r.tr(this.decaf),l.appendChild(p),void 0!==a._desc&&((o=document.createElement("p")).innerHTML=a._desc.tr(this.decaf),l.appendChild(o));var h=a._path||"/";for(var d in"/"!==h.substr(-1)&&(h+="/"),a)if("_"!==d.substr(0,1)){o=document.createElement("div");var c=a[d];r=d.substr(0,1).toUpperCase()+d.substr(1),void 0!==c._name&&(r=c._name);var p,u=h+d,f=c._type||"text";if("boolean"!==f&&((p=document.createElement("label")).setAttribute("for",u),p.innerHTML=r.tr(this.decaf),o.appendChild(p)),"password"===f)(y=document.createElement("input")).setAttribute("id",u),y.setAttribute("type","password"),o.appendChild(y);else if("boolean"===f)(y=document.createElement("input")).setAttribute("id",u),y.setAttribute("type","checkbox"),o.appendChild(y);else if("nochance"===f){(y=document.createElement("select")).setAttribute("id",u);var b=document.createElement("option");b.setAttribute("value","true"),b.innerHTML="Yes",y.appendChild(b),(b=document.createElement("option")).setAttribute("value","false"),b.innerHTML="No",y.appendChild(b),o.appendChild(y)}else(y=document.createElement("input")).setAttribute("id",u),o.appendChild(y);if(void 0!==c._desc)"boolean"===f?(y=document.createElement("label")).setAttribute("for",u):y=document.createElement("p"),y.innerHTML=c._desc.tr(this.decaf),o.appendChild(y);else if("boolean"===f){var y;(y=document.createElement("label")).setAttribute("for",u),y.innerHTML=r.tr(this.decaf),o.appendChild(y)}l.appendChild(o)}i.appendChild(l)}var m=this.container.offsetHeight-(this._input.offsetHeight+17);this.toolbarPadding&&(m-=this.toolbarPadding-12),m<0&&(m=0),e.style.height=m+"px",this.el_display.setAttribute("tabIndex","-1"),this.container.insertBefore(t,this.el_display),this.settings=t,this.set_cont=i,this.set_mid=e,this.tbPressed(this.stbutton,!0),this.tbTooltip(this.stbutton,"Click to close the settings window.".tr(this.decaf))},s.prototype.tbDelete=function(t){if(void 0!==this.toolbuttons[t]){var e=this.toolbuttons[t];e[0].parentNode.removeChild(e[0]),this.toolbuttons[t]=void 0,delete e,this._resizeToolbar()}},s.prototype.tbText=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";if(!e)throw"Text can't be empty/false/null/whatever.";i[0].innerHTML=e,void 0===i[3]&&(i[3]=e,i[0].title=e)},s.prototype.tbTooltip=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";i[3]=e,i[0].title=e||i[1]},s.prototype.tbEnabled=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";e=!!e,i[5]=e,i[0].setAttribute("aria-disabled",!e),e?i[0].className=i[0].className.replace(" disabled",""):/disabled/.test(i[0].className)||(i[0].className+=" disabled")},s.prototype.tbPressed=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";e=!!e,i[6]=e,i[0].setAttribute("aria-pressed",e),e?/toggle-depressed/.test(i[0].className)&&(i[0].className=i[0].className.replace(" toggle-depressed"," toggle-pressed")):/toggle-pressed/.test(i[0].className)&&(i[0].className=i[0].className.replace(" toggle-pressed"," toggle-depressed"))},s.prototype.tbClass=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";var s=i[7];i[7]=e,void 0!==s&&(i[0].className=i[0].className.replace(" "+s,"")),e&&(i[0].className+=" "+e)},s.prototype.tbIcon=function(t,e){var i=this.toolbuttons[t];if(void 0===i)throw"Invalid button ID.";i[2]=e,e?(/ icon/.test(i[0].className)||(i[0].className+=" icon"),i[0].style.cssText="background-image: url("+e+");"):(i[0].className=i[0].className.replace(" icon",""),i[0].style.cssText="")},s.prototype.tbNew=function(t,i,s,o,n,a,l,r){if("function"==typeof i){var h=r;r=i,i=s,s=o,o=n,n=a,a=l,l=h}var d=++this.toolbutton_id,c=document.createElement("a");if(c.id=this.container.id+"-toolbar-button-"+d,c.className="decafmud button toolbar-button",l&&(c.className+=" "+l),1===o&&(c.className+=" toggle "+(a?"toggle-pressed":"toggle-depressed")),c.innerHTML=t,c.title=s||t,!1!==n&&(n=!0),n||(c.className+=" disabled"),c.setAttribute("tabIndex","0"),c.setAttribute("role","button"),c.setAttribute("aria-disabled",!n),1===o&&c.setAttribute("aria-pressed",a),i&&(c.style.cssText="background-image: url("+i+");",c.className+=" icon"),r){var p=this,u=function(t){if("keydown"!==t.type||13===t.keyCode){var e=p.toolbuttons[d];!0===e[5]&&(r.call(p,t),t.type&&"keydown"!==t.type&&e[0].blur())}};e(c,"click",u),e(c,"keydown",u)}return e(c,"focus",function(t){this.parentNode&&/toolbar/.test(this.parentNode.className)&&(this.parentNode.setAttribute("aria-activedescendant",this.id),this.parentNode.className+=" visible")}),e(c,"blur",function(t){this.parentNode&&/toolbar/.test(this.parentNode.className)&&(this.parentNode.getAttribute("aria-activedescendant")===this.id&&this.parentNode.setAttribute("aria-activedescendant",""),this.parentNode.className=this.parentNode.className.replace(" visible",""))}),this.toolbuttons[d]=[c,t,i,s,o,n,a,l,r],c.setAttribute("button-id",d),this.toolbar.appendChild(c),this._resizeToolbar(),d},s.prototype.toolbarPadding=void 0,s.prototype._resizeToolbar=function(){var t=this.store.get("toolbar-position","top-left"),e=this.store.get("toolbar-always",2),i=this.toolbar.style.cssText,s=!1;this.old_tbarpos!==t&&(this.toolbar.className=this.toolbar.className.replace(" "+this.old_tbarpos," "+t),i="top-left"===this.old_tbarpos||"top-right"===this.old_tbarpos?i.replace(/top:[\s\-0-9a-z]+;/g,""):"left"===this.old_tbarpos?i.replace(/left:[\s\-0-9a-z]+;/g,""):i.replace(/right:[\s\-0-9a-z]+;/g,""),this.old_tbarpos=t),e=0!==e&&(1===e||-1!==this.container.className.indexOf("fullscreen")),-1===this.toolbar.className.indexOf(" always-on")&&e?this.toolbar.className+=" always-on":-1===this.toolbar.className.indexOf(" always-on")||e||(this.toolbar.className=this.toolbar.className.replace(" always-on","")),/ always-on/.test(this.toolbar.className)&&/ top-(?:left|right)/.test(this.toolbar.className)?(this.settings&&this.toolbarPadding!==this.toolbar.clientHeight&&(this.settings.style.paddingTop=this.toolbar.clientHeight-5+"px"),this.display&&this.toolbarPadding!==this.toolbar.clientHeight?(this.display.shouldScroll(),this.el_display.style.paddingTop=this.toolbar.clientHeight+"px",this.toolbarPadding=this.toolbar.clientHeight,this.resizeScreen(!1,!0),this.display.doScroll(),s=!0):this.toolbarPadding=this.toolbar.clientHeight):void 0!==this.toolbarPadding&&(this.settings&&(this.settings.style.paddingTop=""),this.display&&(this.display.shouldScroll(),this.el_display.style.paddingTop="0px",this.toolbarPadding=void 0,this.resizeScreen(!1,!0),this.display.doScroll(),s=!0));var o=-1*(this.toolbar.clientWidth-15),n=-1*(this.toolbar.clientHeight-12);return i=/ left/.test(this.toolbar.className)?i.replace(/left:[\s\-0-9a-z]+;/g,"")+"left:"+o+"px;":/ right/.test(this.toolbar.className)?i.replace(/right:[\s\-0-9a-z]+;/g,"")+"right:"+o+"px;":i.replace(/top:[\s\-0-9a-z]+;/g,"")+"top:"+n+"px;",this.toolbar.style.cssText=i,s},s.prototype.showScrollButton=function(){if(void 0===this.scrollButton){var t=document.createElement("div"),i=this;t.className="button scroll-button",t.setAttribute("tabIndex",0),t.innerHTML="More".tr(this.decaf);var s=function(t){"keydown"==t.type&&13!==t.keyCode||i.display.scrollNew()};e(t,"click",s),e(t,"keydown",s),this.scrollButton=t,this.container.appendChild(t),t.style.cssText="bottom:"+(this._input.offsetHeight+12)+"px"}},s.prototype.hideScrollButton=function(){void 0!==this.scrollButton&&(this.scrollButton.parentNode.removeChild(this.scrollButton),this.scrollButton=void 0)},s.prototype.infoBar=function(t,e,i,s,o,n,a){if("number"==typeof e){var l=i;i=e,e=l}void 0===e&&(e="info"),void 0===i&&(i=0);var r={text:t,class:e,timeout:i,icon:s,buttons:o,click:n,close:a};this.infobars.push(r),void 0===this.ibar&&this.createIBar()},s.prototype.immediateInfoBar=function(t,e,i,s,o,n,a){return void 0===this.ibar&&(this.infoBar(t,e,i,s,o,n,a),!0)};var o=function(t,i,s){var o=document.createElement("a");o.className="button",o.setAttribute("href","#"),o.setAttribute("onclick","return false;"),o.innerHTML=i[0],e(o,"click",function(t){return s.closeIBar(!0),setTimeout(function(){i[1].call(s,t)},0),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1}),t.appendChild(o)};s.prototype.createIBar=function(){var t=this,i=this.infobars[0],s=document.createElement("div");s.setAttribute("role","alert"),s.className="decafmud infobar "+i.class,s.innerHTML=i.text,s.style.cssText="top: -26px;",void 0!==i.click&&(s.className+=" clickable",s.setAttribute("tabIndex","0"));var n=function(e){void 0===e||"keydown"===e.type&&13!==e.keyCode&&27!==e.keyCode||("click"!==e.type||i.click)&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),t.closeIBar(!0),"keydown"!==e.type||27!==e.keyCode?i.click&&i.click.call(t,e):i.close&&i.close.call(t,e))};e(s,"click",n),e(s,"keydown",n);var a=document.createElement("div");a.innerHTML="X",a.className="close",a.setAttribute("tabIndex","0");var l=function(e){void 0===e||"keydown"===e.type&&13!==e.keyCode||(t.closeIBar(!0),i.close&&i.close.call(t,e),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())};if(e(a,"click",l),e(a,"keydown",l),s.insertBefore(a,s.firstChild),i.buttons){var r=document.createElement("div");r.className="btncont";for(var h=0;h<i.buttons.length;h++)o(r,i.buttons[h],this);s.insertBefore(r,a)}this.ibar=s,i.el=s,this.container.insertBefore(s,this.container.firstChild),setTimeout(function(){var e=0;window.getComputedStyle?e=parseInt(getComputedStyle(s,null).paddingTop):s.currentStyle&&(e=parseInt(s.currentStyle.paddingTop)),t.toolbarPadding&&(e+=t.toolbarPadding-10),s.style.cssText="background-position: 5px "+e+"px;padding-top: "+e+"px;-webkit-transition: top 0.1s linear;-moz-transition: top 0.1s linear;-o-transition: top 0.1s linear;transition: top 0.1s linear; top: inherit",i.icon&&(s.style.cssText+='background-image: url("'+i.icon+'")')},0),i.timeout>0&&(this.ibartimer=setTimeout(function(){t.closeIBar()},1e3*i.timeout))},s.prototype.closeIBar=function(t){if(void 0!==this.ibar)if(clearTimeout(this.ibartimer),t)this.ibar.parentNode.removeChild(this.ibar),delete this.ibar,this.infobars.shift(),this.infobars.length>0&&this.createIBar();else{this.ibar.style.cssText+="-webkit-transition: opacity 0.25s linear;-moz-transition: opacity 0.25s linear;-o-transition: opacity 0.25s linear;transition: opacity 0.25s linear; opacity: 0";var e=this;this.ibartimer=setTimeout(function(){e.closeIBar(!0)},250)}},s.prototype.addIcon=function(t,i,s,o,n){var a=document.createElement("div");a.className="decafmud status-icon "+s+(o?" icon-click":""),a.innerHTML=i,a.setAttribute("title",t),a.setAttribute("role","status"),a.setAttribute("aria-label",t),(o||n)&&a.setAttribute("tabIndex","0");for(var l=this.icons.push([a,o,n])-1,r=0;r<this.icons.length;r++)this.icons[r][0].style.cssText="right:"+21*(this.icons.length-r-1)+"px";this.tray.appendChild(a);var h=this;return o&&e(a,"click",function(t){o.call(h,t)}),o&&!n&&e(a,"keydown",function(t){13===t.keyCode&&o.call(h,t)}),n&&e(a,"keydown",function(t){n.call(h,t)}),this._resizeTray(),l},s.prototype.delIcon=function(t){if(t<0||t>=this.icons.length)throw"Invalid index for icon!";var e=this.icons[t][0];this.icons.splice(t,1),this._input.removeChild(e),delete e;for(var i=0;i<this.icons.length;i++)this.icons[i].style.cssText="right:"+21*(this.icons.length-i-1)+"px";this._resizeTray()},s.prototype.updateIcon=function(t,e,i,s){if(t<0||t>=this.icons.length)throw"Invalid index for icon!";var o=this.icons[t],n=o[1];o[2],o=o[0],s&&(o.className="decafmud status-icon "+s+(n?" icon-click":"")),i&&(o.innerHTML=i),e&&(o.setAttribute("title",e),o.setAttribute("aria-label",e))},s.prototype._resizeTray=function(){var t=this.tray.clientWidth;this._input.style.cssText="padding-right:"+t+"px"},s.prototype.click_fsbutton=function(t){-1===this.container.className.indexOf("fullscreen")?this.enter_fs():this.exit_fs()},s.prototype.oldscrollX=void 0,s.prototype.oldscrollY=void 0,s.prototype.old_children=[],s.prototype.old_display=[],s.prototype.enter_fs=function(t){if(-1===this.container.className.indexOf("fullscreen")){var e=this.inpFocus;this.display&&this.display.shouldScroll(!1),this.oldscrollY=window.scrollY,this.oldscrollX=window.scrollX,this.old_parent=this.container.parentNode,this.next_sib=this.container.nextElementSibling,void 0===this.next_sib&&this.container.nextSibling&&this.container.nextSibling.nodeType==this.container.nodeType&&(this.next_sib=this.container.nextSibling),this.old_parent.removeChild(this.container),this.container.className+=" fullscreen",this.tbPressed(this.fsbutton,!0),this.tbTooltip(this.fsbutton,"Click to exit fullscreen mode.".tr(this.decaf));for(var s=0;s<document.body.children.length;s++){var o=document.body.children[s];"_firebugConsole"!==o.id&&0!==o.id.indexOf("DecafFlashSocket")&&(this.old_children.push(o),this.old_display.push(o.style.display),o.style.display="none")}this.old_body_over=document.body.style.overflow,i||(document.body.style.overflow="hidden"),document.body.appendChild(this.container),window.scroll(0,0),this._resizeToolbar(),!1!==t&&this.showSize(),e&&this.input.focus(),this.display&&this.display.doScroll()}},s.prototype.exit_fs=function(){if(void 0!==this.old_parent){var t=this.inpFocus;this.display&&this.display.shouldScroll(!1),this.container.parentNode.removeChild(this.container);for(var e=0;e<this.old_children.length;e++)this.old_children[e].style.display=this.old_display[e];this.old_children=[],this.old_display=[];var i=this.container.className.split(" ");for(e=0;e<i.length;)"fullscreen"!==i[e]?e++:i.splice(e,1);this.container.className=i.join(" "),this.tbPressed(this.fsbutton,!1),this.tbTooltip(this.fsbutton,"Click to enter fullscreen mode.".tr(this.decaf)),void 0!==this.next_sib&&null!==this.next_sib?this.old_parent.insertBefore(this.container,this.next_sib):this.old_parent.appendChild(this.container),document.body.style.overflow=this.old_body_over,window.scroll(this.oldscrollX,this.oldscrollY),this._resizeToolbar(),this.showSize(),t&&this.input.focus(),this.display&&this.display.doScroll()}},s.prototype.old_height=-1,s.prototype.old_width=-1,s.prototype.old_fs=!1,s.prototype.goFullOnResize=!0,s.prototype.resizeScreen=function(t,e){if(this.goFullOnResize){var i=!0===window.fullScreen;if(i||(window.outerHeight?i=window.screen.height-window.outerHeight<=5:window.innerHeight&&(i=window.screen.height-window.innerHeight<=5)),i&&!this.old_fs)return this.old_fs=i,void this.enter_fs();if(!i&&this.old_fs)return this.old_fs=i,void this.exit_fs();this.old_fs=i}if(!0===e||this.old_height!==this.container.offsetHeight||this.old_width!==this.container.offsetWidth){this.old_height=this.container.offsetHeight,this.old_width=this.container.offsetWidth;var s=this.old_height-(this._input.offsetHeight+17);this.toolbarPadding&&(s-=this.toolbarPadding-12),s<0&&(s=0),this.settings&&(this.set_mid.style.height=s+"px"),this.toolbarPadding&&(s-=12)<0&&(s=0),this.el_display.style.height=s+"px",!0!==e&&this.display&&this.display.scroll(),this.scrollButton&&(this.scrollButton.style.cssText="bottom:"+(this._input.offsetHeight+12)+"px"),!1!==t&&this.showSize()}},s.prototype.displayInput=function(t){this.display&&this.echo&&this.display.message("<b>"+t+"</b>","user-intput",!1)},s.prototype.localEcho=function(t){t!==this.echo&&(this.echo=t,this.updateInput())},s.prototype.displayKey=function(t){t.altKey||t.ctrlKey||t.metaKey||(t.keyCode>64&&t.keyCode<91||t.keyCode>47&&t.keyCode<58||t.keyCode>185&&t.keyCode<193||t.keyCode>218&&t.keyCode<223)&&this.input.focus()},s.prototype.handleInputPassword=function(t){13===t.keyCode&&(this.inpFocus=!0,this.decaf.sendInput(this.input.value),this.input.value="")},s.prototype.handleInput=function(t){"keydown"===t.type&&(13===t.keyCode?(this.decaf.sendInput(this.input.value),this.input.select()):33===t.keyCode?this.display&&this.display.scrollUp&&(this.display.scrollUp(),t.preventDefault()):34===t.keyCode&&this.display&&this.display.scrollDown&&(this.display.scrollDown(),t.preventDefault()))},s.prototype.handleBlur=function(t){var e=this.input,i=this.decaf.options.set_interface.blurclass;if("blur"===t.type){""===e.value&&(e.className+=" "+i);var s=this;setTimeout(function(){s.settings&&(s.settings.style.top="0px",s.set_mid.style.overflowY="scroll")},100),this.inpFocus=!1}else if("focus"===t.type){for(var o=e.className.split(" "),n=[],a=0;a<o.length;a++)o[a]!==i&&n.push(o[a]);if(e.className=n.join(" "),this.settings){var l=.5*this.settings.clientHeight*-1;this.settings.style.top=l+"px",this.set_mid.style.overflowY="hidden"}this.inpFocus=!0}},s.prototype.updateInput=function(t){if(this.input){var s,o=this.inpFocus,n=this,a=this.input;if(s="TEXTAREA"===this.input.tagName?"text":a.type,!0===t||!(!this.echo&&"password"===s||this.echo&&"password"!==s)){var l,r=a.className,h=a.getAttribute("style"),d=a.id,c=a.parentNode;if(void 0===(l=a.nextElementSibling)&&a.nextSibling&&a.nextSibling.nodeType===a.nodeType&&(l=a.nextSibling),this.echo){var p=1;this.inp_buffer&&(p=this.inp_buffer.substr_count("\n")+1),1===p?(u=document.createElement("input")).type="text":(u=document.createElement("textarea"),i?u.setAttribute("rows",p-1):u.setAttribute("rows",p)),r&&(u.className=r),h&&u.setAttribute("style",h),this.inp_buffer&&(u.value=this.inp_buffer),c.removeChild(a),delete a,delete this.input,d&&(u.id=d),l?c.insertBefore(u,l):c.appendChild(u),this.input=u,e(u,"keydown",function(t){n.handleInput(t)})}else{var u;this.inp_buffer=a.value,(u=document.createElement("input")).type="password",r&&(u.className=r),h&&u.setAttribute("style",h),c.removeChild(a),delete a,delete this.input,d&&(u.id=d),l?c.insertBefore(u,l):c.appendChild(u),this.input=u,e(u,"keydown",function(t){n.handleInputPassword(t)})}this.inpFocus=o;var f=function(t){n.handleBlur(t)};e(this.input,"blur",f),e(this.input,"focus",f),this.inpFocus&&setTimeout(function(){n.input.select(),n.input.focus()},1)}}},t.plugins.Interface.simple=s}(DecafMUD);